<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Nagios by rafaelbm</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Nagios</h1>
        <h2>Trabalho do tio Lu sobre o Nagios</h2>

        <section id="downloads">
          <a href="https://github.com/rafaelbm/Nagios/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/rafaelbm/Nagios/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/rafaelbm/Nagios" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="instalando-nagios-411" class="anchor" href="#instalando-nagios-411" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalando Nagios 4.1.1</h1>

<p>Tutorial baseado no seguinte <a href="http://www.unixmen.com/how-to-install-nagios-core-4-1-1-in-ubuntu-15-10/">post</a>.</p>

<blockquote>
<p>Nagios é sistema, que pode ser usado para monitoramento de infra-estrutura de rede. Usando Nagios, podemos monitorar servidores, switches, aplicações e serviços etc. Alerta o administrador do sistema quando algo der errado e também alertas quando esses erros tenham sido corrigidos.</p>
</blockquote>

<h2>
<a id="funcionaliades" class="anchor" href="#funcionaliades" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Funcionaliades</h2>

<ul>
<li>Monitorar toda sua infraestrutura de ti.</li>
<li>Identify problems before they occur.</li>
<li>Identificar problemas antes que eles aconteçam</li>
<li>Saber imediatamente quando problemas surgirem</li>
<li>Compartilhar dados de disponibilidade com as partes interessadas</li>
<li>Detectar violações de segurança</li>
<li>Planos e orçamento para upgrades de TE.</li>
<li>Reduza as perdas de tempo de inatividade e negócios.</li>
</ul>

<h2>
<a id="pré-requisitos" class="anchor" href="#pr%C3%A9-requisitos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Pré-requisitos</h2>

<p><strong>Para facilitar os passos a seguir execute-os em modo <em>root</em>.</strong></p>

<p>Atualizar o servidor</p>

<pre><code>apt-get update  
apt-get upgrade 
</code></pre>

<p>Instale as dependências do nagios</p>

<pre><code>apt-get install libgd2-xpm-dev libsnmp-perl libssl-dev openssl build-essential apache2 libapache2-mod-php5
</code></pre>

<p>Crie um novo usuário do <strong><em>nagios</em></strong></p>

<pre><code>useradd nagios -g nagios
passwd nagios
</code></pre>

<p>Crie um novo grupo de <strong><em>nagcmd</em></strong> para permitir que comandos externos sejam enviados através da interface web. Adicione o usuário nagios e o usuário do apache ao grupo.</p>

<pre><code>sudo groupadd nagcmd
sudo usermod -a -G nagcmd nagios
sudo usermod -a -G nagcmd www-data  
</code></pre>

<h2>
<a id="baixar-o-nagios-e-plugins" class="anchor" href="#baixar-o-nagios-e-plugins" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Baixar o Nagios e Plugins</h2>

<p>Crie um diretório para armazenar os downloads</p>

<pre><code>mkdir /usr/src/nagios
cd /usr/src/nagios
</code></pre>

<p>Vá para a página do <a href="https://www.nagios.org/downloads/nagios-core/thanks/?t=1466426447">Nagios</a> para obter a versão mais recente, a versão mais recente durante a escrita desse documento é a 4.1.1</p>

<pre><code>wget https://assets.nagios.com/downloads/nagioscore/releases/nagios-4.1.1.tar.gz
</code></pre>

<p>E, baixe também os <a href="https://www.nagios.org/downloads/nagios-plugins/">plugins</a> do nagios</p>

<pre><code>wget http://www.nagios-plugins.org/download/nagios-plugins-2.1.1.tar.gz
</code></pre>

<h2>
<a id="instalar-nagios-e-plugins" class="anchor" href="#instalar-nagios-e-plugins" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalar Nagios e Plugins</h2>

<h3>
<a id="instalar-nagios" class="anchor" href="#instalar-nagios" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalar Nagios</h3>

<p>Va até a pasta onde baixou o nagios, e extraia os arquivos:</p>

<pre><code>tar xzf nagios-4.1.1.tar.gz
</code></pre>

<p>Acesse o diretório extraído:</p>

<pre><code>cd nagios-4.1.1/
</code></pre>

<p>Execute os seguintes comandos um a um para compilar e instalar o nagios.</p>

<pre><code>./configure --with-command-group=nagcmd
make all
make install
make install-init
make install-config
make install-commandmode
</code></pre>

<h3>
<a id="instalar-a-interface-web-do-nagios" class="anchor" href="#instalar-a-interface-web-do-nagios" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalar a interface web do Nagios</h3>

<p>Execute o seguinte comando para compilar e instalar a interface web.</p>

<pre><code>make install-webconf
</code></pre>

<p>Caso o seguinte erro ocorra: </p>

<blockquote>
<p>/usr/bin/install -c -m 644 sample-config/httpd.conf /etc/httpd/conf.d/nagios.conf
/usr/bin/install: cannot create regular file ‘/etc/httpd/conf.d/nagios.conf’: No such file or directory
Makefile:296: recipe for target 'install-webconf' failed
make: *** [install-webconf] Error 1</p>
</blockquote>

<p>A mensagem de erro a cima descreve que o nagios está tentando criar o arquivo <strong>nagios.conf</strong> dentro do diretório <strong>/etc/httpd.conf/ *<em>. Mas em sistemas derivados do Ubuntu o *</em>nagios.conf</strong> deve ser colocado no diretório /etc/apache2/sites-enabled/</p>

<p>Para tal, execute o seguinte comando no lugar do <strong>make install-webconf</strong>.</p>

<pre><code>sudo /usr/bin/install -c -m 644 sample-config/httpd.conf /etc/apache2/sites-enabled/nagios.conf
</code></pre>

<p>Verifique se o <strong>nagios.conf</strong> está no diretório /etc/apache2/sites-enabled.</p>

<pre><code>sudo ls -l /etc/apache2/sites-enabled/
</code></pre>

<p>O output desse comando deve ser semelhante a:</p>

<blockquote>
<p>total 4<br>
lrwxrwxrwx 1 root root 35 Nov 28 16:49 000-default.conf -../sites-available/000-default.conf<br>
-rw-r--r-- 1 root root 1679 Nov 28 17:02 nagios.conf </p>
</blockquote>

<p>Crie um conta <strong><em>nagiosadmin</em></strong> para se autenticar a interface web do Nagios. <strong>Lembre da senha que você definir</strong>, ela será utilizada para logar na interface web.</p>

<pre><code>htpasswd -c /usr/local/nagios/etc/htpasswd.users nagiosadmin
</code></pre>

<p>Reinicie o Apache para que as novas configurações tenham efeito.</p>

<pre><code>service apache2 restart
</code></pre>

<h3>
<a id="instalar-nagios-plugins" class="anchor" href="#instalar-nagios-plugins" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Instalar Nagios Plugins</h3>

<p>Va para o diretório onde você baixou o nagios plugins, e extraia os arquivos.</p>

<pre><code>tar xzf nagios-plugins-2.1.1.tar.gz
</code></pre>

<p>Acesse o diretório extraído:</p>

<pre><code>cd / nagios-plugins-2.1.1/
</code></pre>

<p>Execute os seguintes comandos um a um para compilar e instalar.</p>

<pre><code>./configure --with-nagios-user=nagios --with-nagios-group=nagios
make
make install
</code></pre>

<h2>
<a id="configurar-o-nagios" class="anchor" href="#configurar-o-nagios" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configurar o nagios</h2>

<p>Os arquivos com configurações de exemplo do Nagios estão localizados no diretório <strong>/usr/local/nagios/etc</strong>.Esses arquivos de exemplo devem funcionar bem para uma introdução ao Nagios. No entando, se você quiser, precisará colocar o seu ID e e-mail para receber alertas.</p>

<p>Para tal, edite o arquivo de configuração <strong>/usr/local/nagios/etc/objects/contacts.cfg</strong> e altere o e-mail associado a contato <em>nagiosadmin</em> este e-mail será onde os alertas serão enviados</p>

<pre><code>nano /usr/local/nagios/etc/objects/contacts.cfg
</code></pre>

<p>Encontre a linha a seguir e informe o seu e-mail:</p>

<pre><code> [...]  
 define contact {  
 contact_name                    nagiosadmin             ; Short name of user  
 use                             generic-contact         ; Inherit default values from generic-contact template (defined above)    
 alias                           Nagios Admin            ; Full name of user   
 email                           seuemailaqui.com        ; &lt;&lt;CHANGE THIS TO YOUR EMAIL ADDRESS
 }  
 [...]
</code></pre>

<p>Save and close the file.</p>

<p>Então, edite o arquivo <strong>/etc/apache2/sites-enabled/nagios-conf</strong></p>

<pre><code>nano /etc/apache2/sites-enabled/nagios.conf
</code></pre>

<p>E edite as seguintes linhas, se você desejar acessar o nagios console administrativo de uma determinada
 faixa de IP.</p>

<pre><code>[...]
## Comment the following lines 
#   Order allow,deny
#   Allow from all

## Uncomment and Change lines as shown below
Order deny,allow
Deny from all
Allow from 127.0.0.1 192.168.1.0/24 #seu ip vai aqui
[...]
</code></pre>

<p>Habilitar os módulos do Apache e reconfiguração e cgi</p>

<pre><code>a2enmod rewrite
a2enmod cgi
</code></pre>

<p>Reiniciar o serviço Apache</p>

<pre><code>service apache2 restart
</code></pre>

<p>Verifique se o arquivo <strong>nagios.cfg</strong> contém algum erro de sintaxe:</p>

<pre><code>/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg
</code></pre>

<p>Caso o comando a cima não tenha apontado erros, podemos iniciar o serviço nagios: </p>

<pre><code>service nagios start
</code></pre>

<h2>
<a id="acessar-a-interface-web-do-nagios" class="anchor" href="#acessar-a-interface-web-do-nagios" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Acessar a interface web do Nagios</h2>

<p>Abra seu navegador da web e navegue até <strong>http://{ip-do-server-nagios}/nagios</strong> e digite o nome de usuário como <strong>nagiosadmin</strong> e sua senha que criamos nos passos anteriores.</p>

<p><img src="http://www.unixmen.com/wp-content/uploads/2015/11/192.168.1.103-nagios-Google-Chrome_001.jpg" alt=""></p>

<p>Aqui esta um exemplo da página de administração do Nagios:</p>

<p><img src="http://www.unixmen.com/wp-content/uploads/2015/11/Nagios-Core-Google-Chrome_002.jpg" alt=""></p>

<p>Clique na seção de "Hosts" no painel esquerdo. Você verá os hosts que estão sendo monitorados pelo servidor Nagios. Nós ainda não adicionou nenhum host. Então ele simplesmente monitora o localhost apenas.</p>

<p><img src="http://www.unixmen.com/wp-content/uploads/2015/11/Nagios-Core-Google-Chrome_003.jpg" alt=""></p>

<p>Clique no <em>localhost</em> para exibir mais detalhes</p>

<p><img src="http://www.unixmen.com/wp-content/uploads/2015/11/Nagios-Core-Google-Chrome_004.jpg" alt=""></p>

<p>É isso, instalamos e configuramos o Nagios! </p>
      </section>
    </div>

    
  </body>
</html>
